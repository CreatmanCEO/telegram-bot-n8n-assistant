# ContentAgent - Агент создания текстового контента

## Назначение

ContentAgent — это специализированный агент для создания различных видов текстового контента на основе запросов пользователя. Основная задача агента — генерировать высококачественные тексты для социальных сетей, блогов, электронных писем, статей и других форматов с учетом специфики каждого формата и целевой аудитории.

## Ключевые функции

1. **Создание различных типов контента**:
   - Посты для социальных сетей
   - Статьи и блог-посты
   - Электронные письма
   - Пресс-релизы
   - Рекламные тексты
   - Сценарии для видеороликов

2. **Адаптация стиля и тона** в зависимости от:
   - Целевой аудитории
   - Платформы публикации
   - Цели коммуникации
   - Бренда/личности пользователя

3. **Исследование и интеграция информации**:
   - Поиск и анализ релевантной информации
   - Встраивание фактов и данных
   - Добавление актуальных трендов

4. **Оптимизация контента**:
   - SEO-оптимизация
   - Адаптация для алгоритмов социальных сетей
   - Внедрение ключевых слов и хэштегов

5. **Редактирование и доработка**:
   - Проверка грамматики и стилистики
   - Улучшение структуры и читабельности
   - Адаптация длины и формата

## Структура рабочего потока

Ниже представлена структура рабочего потока ContentAgent в n8n:

```
Workflow Trigger → LLM Agent → Content Research → Content Generation → Content Optimization → Return Result
                        ↓                ↑                                       ↑
                        ↓                ↑                                       ↑
                   Memory System ────────┴───────────────────────────────────────┘
                   (RAG)
```

## Компоненты

### 1. Workflow Trigger Node

**Тип**: `n8n-nodes-base.executeWorkflowTrigger`

**Параметры**:
```json
{
  "parameters": {
    "workflowInputs": {
      "mappingMode": "defineBelow",
      "value": {
        "query": ""
      },
      "schema": [
        {
          "name": "query",
          "required": true,
          "type": "string",
          "description": "Запрос на создание контента с указанием типа, тематики и дополнительных требований"
        }
      ]
    }
  }
}
```

**Назначение**: Принимает запрос от центрального оркестратора и запускает рабочий поток.

### 2. LLM Agent Node

**Тип**: `@n8n/n8n-nodes-langchain.agent`

**Параметры**:
```json
{
  "parameters": {
    "promptType": "define",
    "text": "={{ $json.query }}",
    "options": {
      "systemMessage": "# ContentAgent\n\nТы специализированный агент для создания текстового контента. Твоя задача - генерировать высококачественные тексты различных форматов в соответствии с запросами пользователя.\n\n## Доступные инструменты\n\n1. searchInfo - поиск информации для включения в контент\n2. queryKnowledge - получение информации из базы знаний\n3. optimizeForPlatform - оптимизация контента для конкретной платформы\n4. saveToKnowledge - сохранение созданного контента в базу знаний\n\n## Правила работы\n\n1. Анализируй запрос пользователя и определяй необходимый тип контента\n2. Уточняй детали, если информации недостаточно\n3. Исследуй тему, используя поиск и базу знаний\n4. Создавай контент с учетом специфики платформы и аудитории\n5. Адаптируй стиль, тон и формат под конкретную задачу\n6. Оптимизируй контент для максимальной эффективности\n7. Сохраняй ценный контент в базу знаний для последующего использования\n\n## Процесс создания контента\n\n1. Исследование: собери необходимую информацию\n2. Планирование: создай структуру контента\n3. Написание: создай основной текст\n4. Редактирование: улучши структуру, стиль и читабельность\n5. Оптимизация: адаптируй под требования платформы\n\nТекущая дата: {{ $now }}"
    }
  }
}
```

**Назначение**: Основной LLM-агент, который анализирует запрос пользователя, планирует создание контента и координирует процесс.

### 3. Content Research Tool

**Тип**: `@n8n/n8n-nodes-langchain.toolWorkflow`

**Параметры**:
```json
{
  "parameters": {
    "name": "searchInfo",
    "description": "Поиск информации для создания контента. Используй этот инструмент для получения фактов, данных и актуальной информации по теме.",
    "workflowId": {
      "value": "YOUR_SEARCH_WORKFLOW_ID",
      "mode": "list",
      "cachedResultName": "Search Information"
    },
    "workflowInputs": {
      "mappingMode": "defineBelow",
      "value": {
        "query": "={{ $fromAI(\"query\", \"Запрос для поиска информации\") }}"
      }
    }
  }
}
```

**Назначение**: Интегрирует функционал поиска информации (с помощью SearchAgent) для исследования темы контента.

### 4. Knowledge Base Tool

**Тип**: `@n8n/n8n-nodes-langchain.vectorStorePinecone`

**Параметры**:
```json
{
  "parameters": {
    "mode": "retrieve-as-tool",
    "toolName": "queryKnowledge",
    "toolDescription": "Поиск информации в базе знаний для использования в создаваемом контенте.",
    "pineconeIndex": {
      "value": "knowledge_base",
      "mode": "list"
    },
    "options": {}
  }
}
```

**Назначение**: Предоставляет доступ к базе знаний для использования в создаваемом контенте.

### 5. Platform Optimization Tool

**Тип**: `@n8n/n8n-nodes-langchain.toolHttpFunction`

**Параметры**:
```json
{
  "parameters": {
    "toolDescription": "Оптимизация контента для конкретной платформы (социальная сеть, блог, email и т.д.).",
    "functionCode": "// Функция оптимизации контента для различных платформ\nasync function optimizeForPlatform(platform, content, additionalRequirements) {\n  // Параметры оптимизации для разных платформ\n  const platformSettings = {\n    twitter: {\n      maxLength: 280,\n      hashtagsCount: 3,\n      mediaSupport: true,\n      tone: \"conversational\"\n    },\n    instagram: {\n      maxLength: 2200,\n      hashtagsCount: 15,\n      mediaSupport: true,\n      tone: \"inspirational\"\n    },\n    facebook: {\n      maxLength: 5000,\n      hashtagsCount: 2,\n      mediaSupport: true,\n      tone: \"friendly\"\n    },\n    linkedin: {\n      maxLength: 3000,\n      hashtagsCount: 5,\n      mediaSupport: true,\n      tone: \"professional\"\n    },\n    blog: {\n      maxLength: 10000,\n      hashtagsCount: 0,\n      mediaSupport: true,\n      tone: \"informative\"\n    },\n    email: {\n      maxLength: 4000,\n      hashtagsCount: 0,\n      mediaSupport: false,\n      tone: \"personal\"\n    }\n  };\n  \n  // Проверка наличия платформы в списке\n  if (!platformSettings[platform.toLowerCase()]) {\n    return {\n      optimizedContent: content,\n      recommendations: [`Платформа ${platform} не найдена в списке поддерживаемых платформ.`,\n      \"Контент не был оптимизирован.\"]\n    };\n  }\n  \n  // Получение настроек для указанной платформы\n  const settings = platformSettings[platform.toLowerCase()];\n  \n  // Проверка длины контента\n  const recommendations = [];\n  let optimizedContent = content;\n  \n  if (content.length > settings.maxLength) {\n    recommendations.push(`Контент превышает максимальную длину для ${platform} (${settings.maxLength} символов).`);\n    // Обрезка контента, если он слишком длинный\n    optimizedContent = content.substring(0, settings.maxLength - 3) + '...';\n  }\n  \n  // Добавление хэштегов, если нужно\n  if (settings.hashtagsCount > 0 && additionalRequirements && additionalRequirements.includeHashtags) {\n    recommendations.push(`Для ${platform} рекомендуется использовать до ${settings.hashtagsCount} хэштегов.`);\n  }\n  \n  // Рекомендации по тону\n  recommendations.push(`Для ${platform} рекомендуется использовать ${settings.tone} тон.`);\n  \n  // Рекомендации по медиа\n  if (settings.mediaSupport) {\n    recommendations.push(`${platform} поддерживает медиа-контент, рекомендуется добавить изображения или видео.`);\n  } else {\n    recommendations.push(`${platform} не поддерживает медиа-контент или имеет ограниченную поддержку.`);\n  }\n  \n  return {\n    optimizedContent,\n    recommendations\n  };\n}",
    "responseResolver": "// Response resolver\nreturn await optimizeForPlatform($input.first().json.platform, $input.first().json.content, $input.first().json.additionalRequirements);",
    "placeholderDefinitions": {
      "values": [
        {
          "name": "platform",
          "description": "Название платформы (например, Twitter, Instagram, Facebook, LinkedIn, Blog, Email)",
          "type": "string"
        },
        {
          "name": "content",
          "description": "Текст контента для оптимизации",
          "type": "string"
        },
        {
          "name": "additionalRequirements",
          "description": "Дополнительные требования для оптимизации в формате JSON",
          "type": "object"
        }
      ]
    }
  }
}
```

**Назначение**: Оптимизирует созданный контент для конкретной платформы или формата.

### 6. Save to Knowledge Tool

**Тип**: `@n8n/n8n-nodes-langchain.toolWorkflow`

**Параметры**:
```json
{
  "parameters": {
    "name": "saveToKnowledge",
    "description": "Сохранить созданный контент в базу знаний для последующего использования.",
    "workflowId": {
      "value": "YOUR_SAVE_WORKFLOW_ID",
      "mode": "list",
      "cachedResultName": "Save to Knowledge Base"
    },
    "workflowInputs": {
      "mappingMode": "defineBelow",
      "value": {
        "text": "={{ $fromAI(\"text\", \"Текст для сохранения\") }}",
        "source": "={{ $fromAI(\"source\", \"Источник информации\") }}",
        "category": "={{ $fromAI(\"category\", \"Категория информации\") }}",
        "userId": "={{ $fromAI(\"userId\", \"ID пользователя\") }}"
      }
    }
  }
}
```

**Назначение**: Сохраняет созданный контент в векторную базу данных для последующего использования.

### 7. Language Model Integration

**Тип**: `@n8n/n8n-nodes-langchain.lmChatOpenRouter`

**Параметры**:
```json
{
  "parameters": {
    "model": "anthropic/claude-3-opus-20240229",
    "options": {}
  }
}
```

**Назначение**: Предоставляет доступ к языковой модели Claude-3 через OpenRouter для работы ContentAgent. Claude-3 Opus хорошо подходит для создания сложного творческого контента.

## Системный промпт для ContentAgent (полная версия)

```
# ContentAgent

Ты специализированный агент для создания текстового контента. Твоя задача - генерировать высококачественные тексты различных форматов в соответствии с запросами пользователя.

## Типы контента

1. **Социальные сети**
   - Twitter (X): короткие тексты до 280 символов, с хэштегами
   - Instagram: визуально-ориентированный контент с соответствующими подписями
   - Facebook: разнообразный контент с акцентом на вовлечение
   - LinkedIn: профессиональный контент, ориентированный на бизнес
   - TikTok/Reels: сценарии для коротких видео

2. **Блоги и статьи**
   - Информационные статьи
   - Обучающие руководства
   - Обзоры и рецензии
   - Аналитические материалы
   - Истории и нарративы

3. **Email**
   - Личные письма
   - Маркетинговые рассылки
   - Деловая переписка
   - Информационные бюллетени
   - Автоматические ответы

4. **Маркетинговые материалы**
   - Пресс-релизы
   - Рекламные тексты
   - Лендинги
   - Описания продуктов
   - Коммерческие предложения

5. **Сценарии**
   - Сценарии для видеороликов
   - Подкасты
   - Презентации
   - Вебинары
   - Интервью

## Процесс создания контента

### 1. Анализ запроса
- Определи тип контента
- Выяви ключевую тему или сообщение
- Установи целевую аудиторию
- Выясни цель коммуникации
- Определи требования к стилю и тону

### 2. Исследование
- Собери необходимую информацию по теме
- Используй searchInfo для поиска актуальных данных
- Обратись к queryKnowledge для получения контекста из базы знаний
- Проанализируй тренды и актуальные темы

### 3. Планирование
- Создай структуру контента
- Определи основные точки или аргументы
- Выстрой логическую последовательность
- Составь план для вступления, основной части и заключения

### 4. Создание контента
- Создай первый черновик
- Соблюдай стилистические особенности выбранного формата
- Адаптируй тон под целевую аудиторию
- Используй выразительные, но точные формулировки
- Включи релевантные факты и данные

### 5. Редактирование и оптимизация
- Проверь грамматику и стилистику
- Улучши структуру и читабельность
- Оптими контент для конкретной платформы с помощью optimizeForPlatform
- Добавь ключевые слова, хэштеги или метаданные
- Убедись в соответствии формата требованиям платформы

### 6. Сохранение и доставка
- Сохрани созданный контент в базу знаний с помощью saveToKnowledge
- Предоставь пользователю готовый контент
- При необходимости предложи альтернативные варианты

## Стили и тональность

### Формальный
- Деловой и профессиональный тон
- Строгая структура и логика
- Минимум разговорных выражений
- Полные предложения и правильная грамматика
- Использование специализированной терминологии

### Неформальный
- Разговорный и дружелюбный тон
- Более свободная структура
- Использование повседневного языка
- Короткие, простые предложения
- Возможно использование сленга и разговорных выражений

### Информативный
- Акцент на факты и данные
- Объективное изложение информации
- Логичная структура
- Минимум эмоциональной окраски
- Ссылки на источники и статистику

### Убеждающий
- Акцент на преимуществах и выгодах
- Использование эмоциональных триггеров
- Риторические вопросы и обращения
- Призывы к действию
- Истории и примеры для иллюстрации

### Развлекательный
- Юмор и легкость
- Увлекательные истории
- Неожиданные повороты
- Яркие описания
- Эмоциональность и живость

## Рекомендации по платформам

### Twitter (X)
- Максимальная длина: 280 символов
- Используй хэштеги (3-5)
- Добавляй медиа-контент для увеличения вовлеченности
- Будь лаконичным и выразительным
- Призывай к действию (ретвит, комментарий)

### Instagram
- Визуальный контент важнее текста
- Используй эмоциональный и вдохновляющий тон
- Добавляй до 30 хэштегов (в комментариях)
- Включай призывы к действию
- Используй эмодзи для визуального разделения текста

### Facebook
- Оптимальная длина поста: 50-100 слов
- Используй разнообразный контент (тексты, опросы, медиа)
- Задавай вопросы для вовлечения аудитории
- Персонализируй контент
- Используй истории и личный опыт

### LinkedIn
- Профессиональный тон
- Фокус на экспертизе и ценных инсайтах
- Используй отраслевые хэштеги (до 5)
- Структурируй длинные посты для удобства чтения
- Ссылайся на авторитетные источники

### Блоги
- Оптимальная длина: 1500-2500 слов
- Используй заголовки и подзаголовки (H2, H3)
- Включай списки и маркеры для улучшения читабельности
- Добавляй медиа-контент для иллюстрации
- Оптимизируй для SEO с ключевыми словами

### Email
- Ясный и конкретный заголовок
- Персонализация (обращение по имени)
- Краткость и фокус на одной теме
- Четкий призыв к действию
- Профессиональная подпись

## Доступные инструменты

1. **searchInfo** - поиск информации для включения в контент
   - Параметры:
     - query: запрос для поиска информации

2. **queryKnowledge** - получение информации из базы знаний
   - Параметры:
     - query: запрос для поиска в базе знаний
     - filter: фильтры для поиска (опционально)

3. **optimizeForPlatform** - оптимизация контента для конкретной платформы
   - Параметры:
     - platform: название платформы (Twitter, Instagram, Facebook, LinkedIn, Blog, Email)
     - content: текст для оптимизации
     - additionalRequirements: дополнительные требования в формате JSON

4. **saveToKnowledge** - сохранение созданного контента в базу знаний
   - Параметры:
     - text: текст для сохранения
     - source: источник (например, "content_creation")
     - category: категория (например, "social_media", "blog", "email")
     - userId: ID пользователя

Текущая дата: {{ $now }}
```

## Интеграция с основным рабочим потоком

Для подключения ContentAgent к центральному оркестратору используется узел n8n типа `@n8n/n8n-nodes-langchain.toolWorkflow`. Ниже представлен пример интеграции:

```json
{
  "parameters": {
    "name": "contentAgent",
    "description": "Используйте этот инструмент для создания различного текстового контента: постов для социальных сетей, статей, писем, сценариев и других текстовых материалов.",
    "workflowId": {
      "value": "YOUR_WORKFLOW_ID",
      "mode": "list",
      "cachedResultName": "ContentAgent"
    },
    "workflowInputs": {
      "mappingMode": "defineBelow",
      "value": {
        "query": "={{ $fromAI(\"query\", \"Запрос на создание контента с указанием типа, тематики и требований\") }}"
      }
    }
  },
  "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
  "typeVersion": 2
}
```

## Рекомендации по работе с ContentAgent

### 1. Формулировка запросов

Для получения наилучших результатов рекомендуется формулировать запросы к ContentAgent максимально детально, включая следующую информацию:

- **Тип контента**: четко указывайте нужный формат (пост для Twitter, статья для блога и т.д.)
- **Тематика**: подробно описывайте тему или предмет контента
- **Целевая аудитория**: указывайте, для кого предназначен контент
- **Цель**: объясняйте, чего вы хотите достичь с помощью этого контента
- **Стиль и тон**: уточняйте желаемый стиль (формальный, неформальный, убеждающий)
- **Длина**: указывайте предпочтительную длину или объем контента
- **Ключевые моменты**: перечисляйте важные пункты, которые должны быть включены
- **Ограничения**: указывайте, чего следует избегать

**Пример плохого запроса**:
```
Напиши пост в Инстаграм о здоровом питании
```

**Пример хорошего запроса**:
```
Создай пост для Instagram о преимуществах интервального голодания для людей, ведущих активный образ жизни. Аудитория - мужчины и женщины 25-40 лет, интересующиеся фитнесом и здоровым образом жизни. Стиль - информативный, но мотивирующий, с элементами личного опыта. Включи 3-4 научно обоснованных преимущества, добавь призыв к действию и предложи поделиться опытом в комментариях. Оптимальная длина - до 1000 символов, включи 5-7 релевантных хэштегов.
```

### 2. Использование инструментов для исследования

Для создания фактически точного и актуального контента рекомендуется активно использовать инструменты исследования:

- Используйте `searchInfo` для поиска актуальной информации, статистики и примеров
- Обращайтесь к `queryKnowledge` для поиска связанной информации в базе знаний
- Комбинируйте информацию из разных источников для создания более полного и глубокого контента

### 3. Оптимизация для конкретных платформ

Для максимальной эффективности контента важно адаптировать его под специфику каждой платформы:

- Используйте `optimizeForPlatform` для автоматической адаптации контента
- Учитывайте ограничения и особенности каждой платформы (длина, форматирование, медиа-возможности)
- Следуйте лучшим практикам для каждой платформы (хэштеги, призывы к действию, структура)

### 4. Сохранение и повторное использование контента

Для повышения эффективности работы рекомендуется сохранять созданный контент:

- Используйте `saveToKnowledge` для сохранения удачных примеров контента
- Добавляйте метаданные для удобного поиска и категоризации
- Используйте сохраненный контент как основу или источник вдохновения для новых материалов

## Примеры использования

### Пример 1: Создание поста для социальной сети

**Запрос пользователя**: "Создай пост для LinkedIn о преимуществах автоматизации бизнес-процессов с помощью n8n для малого бизнеса. Включи примеры конкретных процессов, которые можно автоматизировать, и упомяни экономическую выгоду."

**Действия ContentAgent**:
1. Анализирует запрос и определяет тип контента (пост для LinkedIn)
2. Использует `searchInfo` для поиска информации об автоматизации процессов с n8n
3. Использует `queryKnowledge` для поиска дополнительной информации о n8n и автоматизации
4. Создает черновик поста, учитывая специфику LinkedIn
5. Применяет `optimizeForPlatform` для адаптации поста под LinkedIn
6. Сохраняет созданный контент в базу знаний
7. Возвращает готовый пост пользователю

### Пример 2: Создание статьи для блога

**Запрос пользователя**: "Напиши информационную статью для блога о последних трендах в искусственном интеллекте и их применении в маркетинге. Статья должна быть объемом 1500-2000 слов, с подзаголовками, включать конкретные примеры использования и быть доступной для понимания читателями без технического образования."

**Действия ContentAgent**:
1. Анализирует запрос и определяет тип контента (статья для блога)
2. Использует `searchInfo` для поиска информации о трендах в ИИ и маркетинге
3. Составляет структуру статьи с подзаголовками
4. Создает основной текст статьи, с учетом обозначенных требований
5. Применяет `optimizeForPlatform` для оптимизации статьи для блога
6. Добавляет ссылки на источники и статистику
7. Сохраняет статью в базу знаний
8. Возвращает готовую статью пользователю

## Обработка ошибок и ограничений

### 1. Недостаточно информации в запросе

- Запроси дополнительную информацию от пользователя
- Уточни конкретные аспекты запроса, такие как тип контента, целевая аудитория, цель
- Предложи пользователю заполнить шаблон запроса

### 2. Противоречивые требования

- Укажи на противоречия в запросе
- Предложи компромиссные решения
- Объясни ограничения и возможные последствия

### 3. Ограничения платформ

- Уведомляй пользователя о несоответствии требований ограничениям платформы
- Предлагай альтернативные варианты, соответствующие ограничениям
- Объясняй, какие адаптации были сделаны и почему

## Расширение возможностей ContentAgent

### 1. Интеграция с дополнительными инструментами

- **SEO-оптимизация**: интеграция с инструментами для анализа ключевых слов и SEO-оптимизации
- **Проверка плагиата**: интеграция с сервисами проверки уникальности контента
- **Анализ читабельности**: инструменты для оценки и улучшения читабельности текста

### 2. Улучшение процесса создания контента

- **Шаблоны контента**: создание и использование шаблонов для разных типов контента
- **A/B тестирование**: создание нескольких вариантов контента для тестирования
- **Анализ эффективности**: сбор и анализ данных об эффективности созданного контента

### 3. Персонализация контента

- **Учет персональных предпочтений**: адаптация контента под предпочтения конкретного пользователя
- **Анализ аудитории**: интеграция с инструментами анализа аудитории
- **Динамическая персонализация**: создание контента, который можно персонализировать для разных сегментов аудитории