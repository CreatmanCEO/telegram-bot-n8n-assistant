# Обзор текущего состояния системы

## Общая структура

Текущая реализация телеграм-бота на n8n представляет собой базовую систему с центральным оркестратором и несколькими специализированными агентами. Система обрабатывает входящие сообщения из Telegram и перенаправляет их на соответствующие агенты для выполнения конкретных задач.

## Основные компоненты

### Центральный оркестратор (Main)

Центральный оркестратор выполняет следующие функции:
- Принимает входящие сообщения из Telegram
- Классифицирует тип сообщения (текст/голос/медиа)
- Транскрибирует голосовые сообщения в текст через OpenAI
- Анализирует содержимое запроса
- Перенаправляет запрос на соответствующий агент
- Возвращает ответ пользователю

### Специализированные агенты

В текущей реализации присутствуют следующие специализированные агенты:

1. **EmailAgent** - управление электронной почтой
   - Отправка писем
   - Создание черновиков
   - Получение и чтение писем
   - Ответы на письма
   - Управление метками

2. **CalendarAgent** - управление календарем
   - Создание событий
   - Получение списка событий
   - Удаление событий
   - Обновление существующих событий

3. **TwitterAgent (X)** - публикация в Twitter
   - Создание и публикация твитов
   - Имеются проблемы с подключением

4. **FacebookAgent** - публикация в Facebook
   - Создание и публикация постов
   - Имеются проблемы с подключением

### Система памяти

Базовая реализация использует:
- Zep для хранения истории диалогов
- Pinecone для векторной базы данных, но интеграция реализована только частично

### Языковые модели

Система использует OpenRouter для доступа к следующим языковым моделям:
- gpt-4o - основная модель для центрального агента

## Интеграции

Текущая система имеет следующие интеграции:

1. **Telegram** - основной канал взаимодействия с пользователем
2. **OpenRouter** - доступ к языковым моделям
3. **Google Services**
   - Gmail для работы с почтой
   - Google Calendar для работы с календарем
   - Google Drive для работы с файлами
4. **Социальные сети**
   - Twitter (X) - с проблемами в работе
   - Facebook - с проблемами в работе
5. **Pinecone** - векторная база данных (частичная интеграция)

## Ограничения текущей реализации

1. **Ограниченная интеллектуальность**
   - Отсутствие полноценного планирования и приоритизации задач
   - Недостаточное использование контекста из предыдущих взаимодействий

2. **Проблемы с интеграциями**
   - Нестабильная работа Twitter и Facebook интеграций
   - Ограниченное использование возможностей векторной памяти

3. **Отсутствие некоторых запланированных функций**
   - Отсутствие агента для поиска информации
   - Ограниченные возможности для создания медиа-контента
   - Отсутствие глубокого анализа тем

4. **Недостаточная обработка ошибок**
   - Отсутствие надежных механизмов обработки ошибок и восстановления
   - Ограниченные возможности логирования для отладки

## Текущие рабочие процессы

### Обработка текстового сообщения
1. Telegram Trigger получает входящее сообщение
2. Сообщение классифицируется как текст
3. Текст передается в Main Agent
4. Main Agent анализирует запрос и определяет необходимый агент
5. Запрос перенаправляется на соответствующий агент
6. Результат возвращается пользователю

### Обработка голосового сообщения
1. Telegram Trigger получает входящее голосовое сообщение
2. Сообщение классифицируется как голос
3. Voice Transcriber преобразует голос в текст
4. Текст передается в Main Agent
5. Main Agent анализирует запрос и определяет необходимый агент
6. Запрос перенаправляется на соответствующий агент
7. Результат возвращается пользователю

## Инфраструктура

Система развернута на VPS с установленным n8n. Текущая конфигурация включает:
- n8n в качестве платформы для построения рабочих потоков
- Zep для хранения истории диалогов
- Pinecone для векторной базы данных
- Различные API ключи для доступа к внешним сервисам